<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELLIOTT_WAVE_DEPLOYMENT_GUIDE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #24292e;
            background: #ffffff;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        code {
            background-color: rgba(27,31,35,0.05);
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'Courier New', monospace;
        }
        pre {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
        }
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
        }
        table th, table td {
            border: 1px solid #dfe2e5;
            padding: 6px 13px;
        }
        table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            padding: 0 1em;
            margin: 0;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<h1>Elliott Wave &amp; Fibonacci Analysis - Deployment Guide</h1>
<h2>Overview</h2>
<p>This guide covers the deployment and usage of the enhanced daily crypto data collection system with Elliott Wave theory and Fibonacci analysis integrated into the KrakenPro cryptocurrency trading platform.</p>
<h2>What's New</h2>
<h3>1. Elliott Wave Pattern Detection</h3>
<p>The system now automatically detects and analyzes Elliott Wave patterns in daily cryptocurrency data:</p>
<p><strong>Elliott Wave Fields:</strong>
- <code>elliott_wave_degree</code>: Wave classification (Minute, Minor, Intermediate, Primary, Cycle)
- <code>wave_position</code>: Current position in the 5-wave impulse sequence (1-5)
- <code>impulse_wave_count</code>: Number of impulse waves detected
- <code>corrective_wave_count</code>: Number of corrective waves detected
- <code>wave_1_high</code>: Peak of Wave 1
- <code>wave_2_low</code>: Trough of Wave 2
- <code>wave_3_high</code>: Peak of Wave 3 (typically the longest)
- <code>wave_4_low</code>: Trough of Wave 4
- <code>wave_5_high</code>: Peak of Wave 5
- <code>trend_direction</code>: Overall trend (1: uptrend, -1: downtrend, 0: sideways)</p>
<h3>2. Fibonacci Retracement &amp; Extension Levels</h3>
<p>Automatic calculation of key Fibonacci levels for each trading pair:</p>
<p><strong>Fibonacci Retracement Levels:</strong>
- <code>fib_0</code>: 0% level (swing low)
- <code>fib_236</code>: 23.6% retracement
- <code>fib_382</code>: 38.2% retracement (minor support/resistance)
- <code>fib_500</code>: 50% retracement (key psychological level)
- <code>fib_618</code>: 61.8% retracement (golden ratio, major support/resistance)
- <code>fib_786</code>: 78.6% retracement
- <code>fib_100</code>: 100% level (swing high)</p>
<p><strong>Fibonacci Extension Levels:</strong>
- <code>fib_ext_1272</code>: 127.2% extension (profit target 1)
- <code>fib_ext_1618</code>: 161.8% extension (golden ratio extension, profit target 2)
- <code>fib_ext_2618</code>: 261.8% extension (profit target 3)</p>
<p><strong>Distance Metrics:</strong>
- <code>dist_to_fib_236</code>: Percentage distance from current price to 23.6% level
- <code>dist_to_fib_382</code>: Percentage distance to 38.2% level
- <code>dist_to_fib_500</code>: Percentage distance to 50% level
- <code>dist_to_fib_618</code>: Percentage distance to 61.8% level</p>
<h3>3. User Management Tables</h3>
<p>Three new BigQuery tables for Cloud Run deployment:</p>
<p><strong>users table:</strong>
- User authentication and profile information
- Trading preferences and UI settings
- Subscription management
- API key storage (encrypted)
- Activity tracking</p>
<p><strong>trading_sessions table:</strong>
- Session tracking for user activity
- IP address and device information
- Session duration and action counts</p>
<p><strong>user_trades table:</strong>
- Complete trading history
- Entry/exit prices and P&amp;L tracking
- Elliott Wave and Fibonacci levels at entry
- Technical indicator values at trade execution</p>
<h2>Deployment Steps</h2>
<h3>Step 1: Deploy Updated Daily Cloud Function</h3>
<pre class="codehilite"><code class="language-bash">cd cloud_function_daily

# Deploy the updated function with Elliott Wave calculations
python deploy_via_api.py
</code></pre>

<p>The deploy script will:
- Package the updated main.py with Elliott Wave and Fibonacci functions
- Deploy to Google Cloud Functions
- Configure with 540 second timeout
- Allocate 2GB memory</p>
<h3>Step 2: Verify BigQuery Schema Update</h3>
<p>The schema now includes 81 total fields (up from 45):
- 45 original technical indicator fields
- 17 Fibonacci analysis fields
- 10 Elliott Wave detection fields
- 9 helper fields for wave pattern detection</p>
<p>Check the schema:</p>
<pre class="codehilite"><code class="language-bash">bq show cryptobot-462709:crypto_trading_data.crypto_analysis
</code></pre>

<h3>Step 3: Trigger Initial Data Collection</h3>
<pre class="codehilite"><code class="language-bash"># Make function publicly accessible
gcloud functions add-invoker-policy-binding daily-crypto-fetcher \
  --region=us-central1 \
  --member=allUsers \
  --project=cryptobot-462709

# Trigger the function manually
curl https://daily-crypto-fetcher-cnyn5l4u2a-uc.a.run.app
</code></pre>

<p>Wait for completion (approximately 15-20 minutes for ~675 pairs).</p>
<h3>Step 4: Verify Data with Elliott Wave Fields</h3>
<pre class="codehilite"><code class="language-sql">SELECT
  pair,
  close,
  elliott_wave_degree,
  wave_position,
  trend_direction,
  fib_618,
  fib_500,
  dist_to_fib_618,
  wave_3_high,
  wave_5_high
FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
WHERE DATE(datetime) = CURRENT_DATE() - 1
  AND elliott_wave_degree IS NOT NULL
ORDER BY close DESC
LIMIT 20;
</code></pre>

<h3>Step 5: Create User Tables (Already Completed)</h3>
<p>User tables have been created:
- <code>users</code>: User authentication and preferences
- <code>trading_sessions</code>: Session tracking
- <code>user_trades</code>: Trading history</p>
<p>Verify:</p>
<pre class="codehilite"><code class="language-bash">bq ls cryptobot-462709:crypto_trading_data
</code></pre>

<h3>Step 6: Cloud Scheduler Configuration</h3>
<p>The daily scheduler is already configured. Verify it's running:</p>
<pre class="codehilite"><code class="language-bash"># Check scheduler status
gcloud scheduler jobs describe daily-crypto-fetch-job \
  --location=us-central1 \
  --project=cryptobot-462709

# Manually trigger if needed
gcloud scheduler jobs run daily-crypto-fetch-job \
  --location=us-central1 \
  --project=cryptobot-462709
</code></pre>

<h2>Using Elliott Wave Data in Your Application</h2>
<h3>Example Queries</h3>
<h4>Find Crypto in Wave 3 (Strong Uptrend)</h4>
<p>Wave 3 is typically the strongest and longest impulse wave:</p>
<pre class="codehilite"><code class="language-sql">SELECT
  pair,
  close,
  elliott_wave_degree,
  wave_position,
  wave_1_high,
  wave_2_low,
  wave_3_high,
  trend_direction,
  rsi,
  macd
FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
WHERE DATE(datetime) = CURRENT_DATE() - 1
  AND wave_position = 3
  AND trend_direction = 1
  AND rsi &lt; 70  -- Not overbought
ORDER BY (wave_3_high - wave_1_high) DESC
LIMIT 10;
</code></pre>

<h4>Find Crypto at Key Fibonacci Levels</h4>
<pre class="codehilite"><code class="language-sql">SELECT
  pair,
  close,
  fib_618,
  fib_500,
  fib_382,
  dist_to_fib_618,
  rsi,
  macd,
  trend_direction
FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
WHERE DATE(datetime) = CURRENT_DATE() - 1
  AND ABS(dist_to_fib_618) &lt; 2  -- Within 2% of 61.8% level
  AND trend_direction = 1
ORDER BY rsi ASC
LIMIT 10;
</code></pre>

<h4>Find Wave 5 Completion (Potential Reversal)</h4>
<p>Wave 5 often marks the end of an impulse sequence:</p>
<pre class="codehilite"><code class="language-sql">SELECT
  pair,
  close,
  elliott_wave_degree,
  wave_position,
  wave_5_high,
  wave_3_high,
  fib_ext_1618,
  rsi,
  macd_hist,
  trend_direction
FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
WHERE DATE(datetime) = CURRENT_DATE() - 1
  AND wave_position = 5
  AND rsi &gt; 70  -- Overbought - potential reversal
  AND close &gt;= fib_ext_1618  -- Price at extension level
ORDER BY rsi DESC
LIMIT 10;
</code></pre>

<h4>Combine Elliott Wave + Fibonacci + Technical Indicators</h4>
<pre class="codehilite"><code class="language-sql">WITH analysis AS (
  SELECT
    pair,
    close,
    elliott_wave_degree,
    wave_position,
    trend_direction,
    fib_618,
    fib_500,
    dist_to_fib_618,
    dist_to_fib_500,
    rsi,
    macd,
    macd_signal,
    adx,
    wave_2_low,
    wave_3_high
  FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
  WHERE DATE(datetime) = CURRENT_DATE() - 1
)
SELECT *
FROM analysis
WHERE
  -- Elliott Wave: Looking for Wave 3 or early Wave 4
  wave_position IN (3, 4)
  -- Fibonacci: Price near 38.2% or 50% retracement
  AND (ABS(dist_to_fib_500) &lt; 3 OR ABS(dist_to_fib_618) &lt; 3)
  -- Trend: Uptrend
  AND trend_direction = 1
  -- RSI: Not overbought
  AND rsi BETWEEN 30 AND 70
  -- MACD: Positive momentum
  AND macd &gt; macd_signal
  -- ADX: Strong trend
  AND adx &gt; 25
ORDER BY adx DESC, rsi ASC
LIMIT 20;
</code></pre>

<h2>Elliott Wave Trading Rules</h2>
<h3>Wave 1 (Initial Impulse)</h3>
<ul>
<li>Often difficult to identify in real-time</li>
<li>Usually accompanied by low volume</li>
<li><strong>Entry</strong>: Wait for Wave 2 pullback</li>
</ul>
<h3>Wave 2 (Correction)</h3>
<ul>
<li>Typically retraces 38.2% to 61.8% of Wave 1</li>
<li>Should NOT retrace more than 100% of Wave 1</li>
<li><strong>Entry</strong>: Buy near Fibonacci 61.8% level with confirmation</li>
</ul>
<h3>Wave 3 (Strongest Move)</h3>
<ul>
<li>Usually the longest and strongest wave</li>
<li>Must be longer than both Wave 1 and Wave 5</li>
<li>High volume, strong momentum</li>
<li><strong>Entry</strong>: Early Wave 3 or on pullbacks</li>
<li><strong>Target</strong>: Fibonacci extensions (127.2%, 161.8%)</li>
</ul>
<h3>Wave 4 (Correction)</h3>
<ul>
<li>Often retraces 23.6% to 38.2% of Wave 3</li>
<li>Should NOT overlap with Wave 1 price territory</li>
<li><strong>Entry</strong>: Buy near Fibonacci 38.2% level</li>
</ul>
<h3>Wave 5 (Final Impulse)</h3>
<ul>
<li>Often shows divergence on indicators (RSI, MACD)</li>
<li>Volume often lower than Wave 3</li>
<li><strong>Exit</strong>: Near Fibonacci extension levels</li>
<li><strong>Warning</strong>: Reversal likely after Wave 5 completion</li>
</ul>
<h2>Integration with Stock Price App</h2>
<p>The trading app now has access to:</p>
<ol>
<li><strong>Daily Elliott Wave data</strong> for all ~675 USD crypto pairs</li>
<li><strong>Fibonacci levels</strong> automatically calculated and updated daily</li>
<li><strong>User tables</strong> ready for authentication when deployed to Cloud Run</li>
</ol>
<h3>Next Steps for Frontend Integration:</h3>
<ol>
<li><strong>Query Elliott Wave data</strong> from BigQuery</li>
<li><strong>Display wave patterns</strong> on charts with visual indicators</li>
<li><strong>Show Fibonacci levels</strong> as horizontal lines on price charts</li>
<li><strong>Implement alerts</strong> when price reaches key Fibonacci levels</li>
<li><strong>Highlight opportunities</strong> when Wave + Fibonacci + Technical indicators align</li>
</ol>
<h2>Monitoring and Maintenance</h2>
<h3>Check Daily Function Logs</h3>
<pre class="codehilite"><code class="language-bash">gcloud functions logs read daily-crypto-fetcher \
  --project=cryptobot-462709 \
  --limit=50
</code></pre>

<h3>Verify Data Freshness</h3>
<pre class="codehilite"><code class="language-sql">SELECT
  DATE(datetime) as date,
  COUNT(DISTINCT pair) as unique_pairs,
  COUNT(*) as total_records,
  COUNTIF(elliott_wave_degree IS NOT NULL) as with_elliott_wave,
  COUNTIF(fib_618 IS NOT NULL) as with_fibonacci
FROM `cryptobot-462709.crypto_trading_data.crypto_analysis`
WHERE DATE(datetime) &gt;= CURRENT_DATE() - 7
GROUP BY date
ORDER BY date DESC;
</code></pre>

<h3>Monitor Scheduler</h3>
<pre class="codehilite"><code class="language-bash">gcloud scheduler jobs list \
  --project=cryptobot-462709 \
  --location=us-central1
</code></pre>

<h2>Cost Estimates</h2>
<p>Updated monthly costs with Elliott Wave calculations:</p>
<ul>
<li><strong>Cloud Functions</strong>: ~$4/month (daily function)</li>
<li>Executions: ~30/month</li>
<li>Duration: ~20 minutes per run</li>
<li>
<p>Memory: 2GB</p>
</li>
<li>
<p><strong>BigQuery Storage</strong>: ~$3/month (increased from $2)</p>
</li>
<li>Daily table: ~81 fields × 675 pairs × 365 days</li>
<li>
<p>User tables: Minimal initial storage</p>
</li>
<li>
<p><strong>BigQuery Queries</strong>: Pay-per-query</p>
</li>
<li>$5/TB scanned</li>
<li>Elliott Wave queries typically scan 10-100 MB</li>
</ul>
<p><strong>Total Estimated Cost</strong>: ~$7-10/month</p>
<h2>Troubleshooting</h2>
<h3>Elliott Wave Not Detected</h3>
<p>Some pairs may not have enough data for wave pattern detection:
- Requires minimum 13 daily candles
- Requires identifiable swing highs and lows
- Check <code>swing_high</code> and <code>swing_low</code> boolean fields</p>
<h3>Fibonacci Levels Missing</h3>
<p>Fibonacci calculation requires:
- At least 1 recent swing high
- At least 1 recent swing low
- Check data availability for the specific pair</p>
<h3>Schema Mismatch</h3>
<p>If you encounter schema errors:
1. Backup existing data
2. Drop and recreate table with new schema
3. Re-run historical data collection</p>
<h2>Support and Documentation</h2>
<ul>
<li><strong>Elliott Wave Theory</strong>: Classic 5-wave impulse + 3-wave correction pattern</li>
<li><strong>Fibonacci Ratios</strong>: 23.6%, 38.2%, 50%, 61.8%, 78.6%, 127.2%, 161.8%, 261.8%</li>
<li><strong>BigQuery Documentation</strong>: https://cloud.google.com/bigquery/docs</li>
<li><strong>Cloud Functions</strong>: https://cloud.google.com/functions/docs</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: 2025-11-07
<strong>Version</strong>: 2.0 with Elliott Wave &amp; Fibonacci Analysis
<strong>Project</strong>: cryptobot-462709</p>
</body>
</html>